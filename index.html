<!DOCTYPE html>
<html lang="en">
<head>
  <!-- [Previous head content remains the same] -->
</head>
<body>
  <!-- [Previous body content remains the same until the script] -->

  <script>
    const API_ENDPOINT = "https://gpt-3-5.apis-bj-devs.workers.dev/";
    
    async function fetchGPTResponse() {
      const prompt = document.getElementById("prompt").value.trim();
      const responseBox = document.getElementById("responseBox");

      if (!prompt) {
        showError("Error: No command entered");
        return;
      }

      showLoading("Connecting to darknet servers...");

      try {
        // First try direct connection
        let response = await fetchWithTimeout(API_ENDPOINT, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer YOUR_API_KEY" // Add if required
          },
          body: JSON.stringify({
            prompt: prompt,
            max_tokens: 1000,
            temperature: 0.7
          })
        }, 5000);

        // If first attempt fails, try with CORS proxy
        if (!response.ok) {
          showLoading("Attempting proxy connection...");
          response = await fetchWithTimeout(`https://cors-anywhere.herokuapp.com/${API_ENDPOINT}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-Requested-With": "XMLHttpRequest"
            },
            body: JSON.stringify({
              prompt: prompt,
              max_tokens: 1000,
              temperature: 0.7
            })
          }, 8000);
        }

        if (!response.ok) throw new Error(`API responded with status ${response.status}`);

        const data = await response.json();
        
        if (data.choices?.[0]?.text) {
          showSuccess(data.choices[0].text);
        } else {
          showError("Received corrupted data payload");
        }
      } catch (error) {
        console.error("Hacker Debug:", error);
        showError(`Darknet Connection Failed<br><br>
          Possible causes:<br>
          1. API endpoint offline<br>
          2. Network firewall blocking<br>
          3. Invalid authentication<br><br>
          Technical details: ${error.message}`);
      }
    }

    // Helper functions
    async function fetchWithTimeout(url, options, timeout) {
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeout);
      const response = await fetch(url, {
        ...options,
        signal: controller.signal
      });
      clearTimeout(id);
      return response;
    }

    function showLoading(message) {
      document.getElementById("responseBox").innerHTML = 
        `<span style="color:#ff6600">${message} <span class="typing"></span></span>`;
      document.getElementById("responseBox").style.display = "block";
    }

    function showSuccess(message) {
      document.getElementById("responseBox").innerHTML = 
        `<span style="color:#00ff00">${formatResponse(message)}</span>`;
    }

    function showError(message) {
      document.getElementById("responseBox").innerHTML = 
        `<span style="color:#ff0000">${message}</span>`;
    }

    function formatResponse(text) {
      return text.replace(/\n/g, '<br>')
        .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" style="color:#00ffff">$1</a>');
    }

    // [Rest of your existing code]
  </script>
</body>
</html>
